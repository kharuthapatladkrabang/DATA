// *********************************************************************************
// âš ï¸ à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ URL à¸—à¸µà¹ˆ Deploy à¹à¸¥à¹‰à¸§à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹‚à¸”à¸¢à¸•à¸£à¸‡
// *********************************************************************************
const EXTERNAL_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwP6xqSp9W9GFDbgmvroau7cVFRpIubRRqBpaN8-24J9nSmnKH22PDwaunCEn8It1OPaw/exec';

// =================================================================
// CORE API FETCHER
// =================================================================

async function callAppsScriptAPI(action, params = {}) {
    const url = new URL(EXTERNAL_WEB_APP_URL);
    url.searchParams.set('action', action);
    
    for (const key in params) {
        url.searchParams.set(key, params[key]);
    }

    try {
        const response = await fetch(url.toString(), {
            method: 'POST' 
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const contentType = response.headers.get("content-type");
        if (contentType && contentType.indexOf("application/json") !== -1) {
            return response.json();
        } else {
            throw new Error("API response was not valid JSON. Check Apps Script Deployment/Logs.");
        }
    } catch (error) {
        console.error(`Error calling action=${action}:`, error);
        return { success: false, message: error.message };
    }
}

// =================================================================
// WRAPPER FUNCTIONS 
// =================================================================

/** à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸›à¸¸à¹ˆà¸¡ Studio à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” */
async function getStudioList() {
    const result = await callAppsScriptAPI('get_studio_list');
    return result.success ? result.studioNames : [];
}

/** à¸”à¸¶à¸‡à¸„à¹ˆà¸² Config à¸‚à¸­à¸‡ Studio à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸ */
async function getStudioConfig(studioName) {
    const result = await callAppsScriptAPI('get_geofence_config', { studio: studioName });
    return result.success ? result : null;
}

/** à¸”à¸¶à¸‡à¸„à¹ˆà¸² Config à¸ªà¸³à¸«à¸£à¸±à¸š Announcement */
async function getAnnouncementConfig() {
    const result = await callAppsScriptAPI('get_announcement_image');
    return result.success ? result : null;
}

// ðŸ’¡ à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡à¹ƒà¸™à¹€à¸§à¹‡à¸šà¸ à¸²à¸¢à¸™à¸­à¸ (à¸•à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰)
/*
async function loadExternalData() {
    const names = await getStudioList();
    console.log("Names:", names);
    
    if (names.length > 0) {
        const config = await getStudioConfig(names[0]);
        console.log("Config for first studio:", config);
    }
}
// window.onload = loadExternalData;
*/
